<template>
<div id="section">
    <div id="animation">
    <div id="pointer">
        <router-link to="/">&lt;</router-link>
    </div>
        <div id="sticky_box">
            <div class="text_box">
                <h1>アラブの戦力</h1>
                <p>正式な軍隊を持ち、なおかつイスラエルを包囲していたアラブ諸国はイスラエルへの勝利は容易と見ていた。開戦時は戦力数は拮抗していたものの、装備などでは優位性を保っておりイスラエル軍を撃破することが出来ていた。
                <br>しかしイスラエル軍が反撃に転じると、アラブ連合軍は防衛線を築くのに苦労した。アラブ連合軍はアラブ諸国が各々投じた軍隊で形成されていたため、各国間で連携が取れず、加えて各国の政治利益なども絡まったことによりアラブ連合軍の組織力は低下していった。この事態は後々、アラブ諸国間同士の不信感を生み出す一つの原因となっていく。
                </p>
            </div>
            <div id="animation_container">
                <svg id="svg" viewBox="0 0 1024.3365 990.0002">
                <g>
                    <circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/><circle class="marker" cx="0" cy="0" r="43.2732"/>
                    <path class="marker" d="M0,43.2732A43.2732,43.2732,0,0,0,43.2732,86.5466V0A43.2732,43.2732,0,0,0,0,43.2732Z"/>
                    <rect id="flag" x="0" y="0" />
                </g>
                <g>
                    <line class="animation_path" x1="297.3515" y1="213.1357" x2="117.595" y2="915.5327"/><line class="animation_path" x1="390.9461" y1="213.1357" x2="117.5951" y2="821.9381"/><line class="animation_path" x1="484.5407" y1="213.1358" x2="117.5951" y2="728.3435"/><line class="animation_path" x1="578.1353" y1="213.1358" x2="117.5951" y2="634.7489"/><line class="animation_path" x1="671.7299" y1="213.1358" x2="117.5952" y2="541.1543"/><line class="animation_path" x1="297.3515" y1="314.8255" x2="117.595" y2="439.5327"/><line class="animation_path" x1="390.9461" y1="314.8255" x2="117.595" y2="345.9381"/><line class="animation_path" x1="484.5407" y1="314.8255" x2="117.595" y2="252.3435"/><line class="animation_path" x1="578.1353" y1="314.8256" x2="117.5951" y2="158.7489"/><line class="animation_path" x1="671.7299" y1="314.8256" x2="117.5951" y2="65.1543"/><line class="animation_path" x1="297.3514" y1="416.5153" x2="322.7052" y2="908.6475"/><line class="animation_path" x1="390.946" y1="416.5153" x2="322.7051" y2="812.2577"/><line class="animation_path" x1="484.5406" y1="416.5153" x2="322.7052" y2="718.6631"/><line class="animation_path" x1="578.1352" y1="416.5154" x2="322.7052" y2="625.0685"/><line class="animation_path" x1="671.7298" y1="416.5154" x2="527.8141" y2="908.6471"/><line class="animation_path" x1="297.3514" y1="518.2051" x2="527.8141" y2="815.0525"/><line class="animation_path" x1="390.946" y1="518.2051" x2="527.8142" y2="721.4579"/><line class="animation_path" x1="484.5406" y1="518.2051" x2="732.9237" y2="908.6475"/><line class="animation_path" x1="578.1352" y1="518.2052" x2="732.9237" y2="815.0529"/><line class="animation_path" x1="671.7298" y1="518.2052" x2="732.9238" y2="721.4583"/><line class="animation_path" x1="297.3514" y1="619.8315" x2="938.0332" y2="908.6475"/><line class="animation_path" x1="390.946" y1="619.8949" x2="938.0329" y2="814.4861"/><line class="animation_path" x1="484.5406" y1="619.8949" x2="938.0329" y2="720.8915"/><line class="animation_path" x1="556.4986" y1="619.895" x2="322.9204" y2="553.1105"/>
                </g>
                </svg>
                <!-- <div id="logging"></div> -->
                <div class="legend">
                    <div id="leg_box">
                    <h2>アラブ連合軍合計</h2>
                    <h2 style="font-size: 50px">23500</h2>
                    </div>
                </div>
                <div class="legend">
                    <h3>エジプト</h3>
                    <h3>ヨルダン</h3>
                    <h3>イラク</h3>
                    <h3>シリア</h3>
                    <h3>レバノン</h3>
                </div>
            </div>
        </div>
    </div>
</div>
</template>

<style scoped>
#animation{
    height: 200vh;
}
#sticky_box{
    position: sticky;
    top: 12vh;
}
#pointer{
  position: sticky;
  top: 50vh;
  width: 10%;
  z-index: 10;
}
a{
  text-decoration: none;
  font-size: 500%;
  color: #0e8136;
  height: 100%;
  /* background-color: red; */
}
#animation_container{
    width: 500px;
    height: 100vh;
    position: absolute;
    top: 10vh;
    right: 20vw;
    /* float: right; */
}
.marker{
    fill:#0e8316;
}
.animation_path{
    fill:none;
    stroke:none;
}
.legend{
    width: 100%;
}
.legend #leg_box{
    position: absolute;
    top: 45%;
    left: 15%;
    margin-top: 3%;
    font-size: 30px;
}
.legend #leg_box h2{
    margin: 0;
}
.legend h3{
    float: left;
    width: 20%;
    font-size: 20px;
}
.text_box{
    position: absolute;
    top: 10vh;
    left: 18vw;
    width: 27%;
}
.text_box h1{
    font-size: 80px;
    border-bottom: 3px solid #0e8316;
    margin-bottom: 25px;
}
#flag{
    fill: blue;
}
#logging{
    position: sticky;
    opacity: 0.5;
    top: 0;
}
</style>
<script>
export default{
    methods:{
        getRatio(el){
            var par = el.parentNode;
            // console.log(par.scrollHeight);
            return(el.scrollTop || par.scrollTop) / (par.scrollHeight - par.clientHeight);
        },
        moveCircle(){
            var targetPath = document.getElementsByClassName("animation_path");
            var circle = document.getElementsByClassName("marker");
            var arrlength = targetPath.length;
            var ratio = this.getRatio(document.body);
            this.opacityControl(ratio);
            // console.log("hi");

            for(var i = 0; i < arrlength; i++){
                var path_len = targetPath[i].getTotalLength();
                var point = targetPath[i].getPointAtLength(ratio * path_len);

                circle[i].setAttribute("transform","translate("+point.x + ","+ point.y+")");

                if(i == arrlength - 1){
                    var wid = circle[i].getBoundingClientRect().width;
                    var hgt = circle[i].getBoundingClientRect().height;
                    var ptX = point.x - wid;
                    var ptY = point.y - hgt;
                    var deg = -90 * ratio;
                    circle[i].setAttribute("transform","translate("+ptX + ","+ ptY+") rotate("+deg+","+wid+","+hgt+")");
                    document.getElementById("logging").innerHTML = ptX+" = "+point.x+" - "+wid;
                }
            }          
        },
        opacityControl(ratio){
            var h2 = document.querySelectorAll(".legend h2");
            var h3 = document.querySelectorAll(".legend h3");
            h2.forEach(el => {
                el.style.opacity = 1 - ratio;
                if(el.style.opacity == 0){
                    el.style.display = "none";
                } else {
                    el.style.display = "block"
                }
            });
            h3.forEach(el => {
                el.style.opacity = ratio;
                if(el.style.opacity == 0){
                    el.style.display = "none";
                } else {
                    el.style.display = "block";
                }
            })
        }
    },
    created(){
        this.moveCircle();
        document.addEventListener("scroll", this.moveCircle);
    },
}

</script>